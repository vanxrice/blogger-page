<link rel="import" href="../polymer/polymer.html">

<polymer-element name="blogger-post" attributes="post">
  <template is="auto binding" bind="{{post}}">
    <style>
      :host {
        display: block;
      }
    </style>

    <h2>{{post.published.$t}}</h2>

    <a href="{{externalLink}}"><h3>{{post.title.$t}}</h3></a>

    <div id="content"></div>
  </template>
  <script>
    (function () {
      Polymer('blogger-post', {
        post: null,

        ready: function() {
          if (this.post) {
            if (this.post.published.$t) {
              // convert post published date to locale time
              // console.log(this.post.published.$t);
              var publishedDate = new Date(this.post.published.$t);
              // console.log(publishedDate);
              // TODO toLocaleString() does not seem to calculate time locale correctly, but it's Javascript standard, so I'll keep for now.
              this.post.published.$t = publishedDate.toLocaleString();
            }
            if (this.post.content.$t) {
              var t = document.createElement('template');
              t.innerHTML = this.post.content.$t;
              this.$.content.appendChild(this.instanceTemplate(t));
            }
            if (this.post.link) {
              var matches = this.post.link.filter(function(ele) {
                if (ele.rel === 'alternate') {
                  return true;
                }
                return false;
              });
              if (matches.length === 1) {
                this.externalLink = matches[0].href;
              }
            }
          }
        }
      });
    })();
  </script>
</polymer-element>
